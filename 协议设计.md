## 协议设计

术语：

+ 客户端：一开始没有某个文件的主机
+ 服务器：一开始拥有某个文件的主机

任意的主机都可以作为某个文件的客户端和服务器。

此协议有8种操作：

+ GET_DATA，向一个客户端或服务器请求数据
+ GET_FILE_INFO，向一个客户端或服务器请求文件信息
+ GET_BLOCK_INFO，向一个客户端或服务器请求某个文件的某个块的信息
+ DATA，传输某个文件的某个块的数据
+ ERROR，表示自己没有某个文件的某个块
+ FILE_INFO，一个文件的信息，除服务器外网络中的每个客户端所有的文件块数
+ BLOCK_INFO，一个文件中某个块的信息，即这个块被除服务器外的哪个客户端所有
+ GET_OK，这是唯一会改变状态的报文，当某个客户端(A)或服务器受到该报文后，它必须标记报文的发送者(B)拥有该报文所指出的对应文件的对应块

所有的客户端和服务器都必须开放4000端口，所有的客户端和服务器可以连接任意客户端和服务器的该端口，并发送**任意报文**。被连接的客户端和服务器可以同时向对方发送**任意报文**。本协议不规定除GET_OK以外的客户端和服务器行为。

## 典型实现

有两种典型实现，示意如下：

A -> B (GET_FILE_INFO)

A <- B (在同一个TCP连接内，FILE_INFO)

或者

A -> B (GET_FILE_INFO)

B -> A (B主机连接A的4000端口，发送FILE_INFO消息)